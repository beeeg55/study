# Section5. EC2 기초

Date: June 1, 2023 → June 2, 2023

EC2 ( elastic compute cloud)  

- 서비스형 인프라스트럭처
- 가상머신 렌트할수있음(EC2)
- 가상드라이브에 메모리 저장(EBS)
- 로드를 분산(ELB)
- 서비스를 확장(ASG - 오토스케일링그룹)

방화벽 규칙(시큐리티그룹) ,코어, 램, 스토리지, 운영체제, 네트워크 카드 등 여러옵션이 모두 설정이 가능하다

부트스트래핑 : 머신이 시작될때 명령을 시작하는 것

→ 부팅작업을 자동화. 모든명령어는 sudo로!

인스턴스 유형은 CPU개수, 메모리 용량 등에 따라 다름

인스턴스를 중지후 재시작하면 public ipv4는 변경된다. 하지만 사설IP는 항상 같은상태로 유지된다.

인스턴스는 7가지 유형이 있다. 

시험출제

- 범용의 인스턴스 (General Purpose)
    - 활용 : 웹서버, 코드 저장소 등의 다양한 작업
    - 컴퓨팅, 메모리, 네트워킹 간의 균형 굳
- 컴퓨터 최적화 (Compute Optimized)
    - 일부 데이터 일괄처리
    - 활용 : 고성능 웹서버, HPC 작업, 머신러닝, 게임 서버 등
    
    → 훌륭한 CPU와 컴퓨팅을 요구하는 작업들
    
    C로 시작함 C5,C6등
    
- 메모리 최적화 (Memory Optimized)
    - 메모리에서 대규모 데이터셋을 처리하는 유형
    - 활용 : 고성능의 관계형, 비관계형 데이터베이스, ELASTIC 캐시, 분산 캐시 등, BI 에 최적화된 데이터베이스, 대규모 비정형 데이터의 실시간 처리를 실행하는 애플리케이션 등
    - RAM을 뜻하는 r로 주로시작, 하지만 X1이나 Z1도 있음
- 스토리지 최적화 (Storage Optimized)
    - 로컬스토리지에서 대규모의 데이터셋에 액세스할때 적합한 인스턴스
    - 활용 : 관계형과 비관계형인 nosql db, 고주파 온라인 트랜잭션 처리 OLTP, 데이터웨어하우싱 애플리케이션, 분산파일 시스템
    

Security Group

- 인스턴스의 방화벽이다. EC2 외부에 있다
- EC2 인스턴스에 들어오고 나가는 트래픽 제어
- 허용 규칙만을 포함한다
- 인바운드/아웃바운드 트래픽여부 통제(기본적으로 모든 인바운드차단. 아웃바운드 허용)
- 포트로의 액세스를 통제
- 인증된 IP주소의 범위를 확인
- 여러 인스턴스에 연결할 수 있음(1:1관계아님)
- SSH를 위한 별도의 보안그룹을 관리하는 것을 추천함
- **타임아웃이 계속발생하면 보안그룹의 문제다. 하지만 연결이 거부되었다는 오류는 보안그룹은 실행되었지만 어플리케이션에 문제가 있는것이다.**
- 보안그룹에 보안그룹을 등록하는것이 좋은방법
- **시험출제 -  SSH, SFTP 22번포트(리눅스에 굳), FTP 21번포트, HTTP 80포트, HTTPS 443포트, RDP(원격 데스크톱) 3389포트(윈도우에 굳)**

SSH 

- 명령줄 인터페이스
- 맥, 리눅스, 윈도우 10이상에서 사용
- 터미널에서 ssh접속 명령어 - ssh -i key이름 ec2-user@공용ip
- EC2인스턴스에 직접 accesskey,id 를 입력하는것은 보안상 최악임 → **IAM 역할을 사용해야함**

EC2 비용유형 - **워크로드에 적합한게 어떤 타입의 인스턴스인지알아야함(시험)**

- EC2 ON DEMAND
    - 비용이 가장 많이 들지만 바로 지불할 금액은 없다.
    - 장기적인 약정 필요 x
    - 단기적이고 중단없는 워크로드 필요, 예측불가능한 애플리케이션에 추천
- 예약 인스턴스
    - up to 72% 할인 온디맨드 예약
    - 1 or 3년 기간 예약
    - 인스턴스타입, 리전, OS 등을 예약
    - 사용량이 일정한 애플리케이션 (DB등)
- 전환형 예약 인스턴스
    - 인스턴스타입, OS 등을 변경가능
    - up to 66% 할인
- EC2 절약 플랜
    - 장시간 사용시 할인 (예약인스턴스와 같은 할인률)
    - 사용량 한도 넘으면 온디맨드 가격으로 청구
    - 특정한 가격을 오랜기간 지불
- 스폿 인스턴스
    - 온디맨드의 upto 90% 할인
    - 가장 비용효울적이지만 손실가능성 → 즉 실패에 대한 회복력이 중요
    - 배치작업, 데이터분석, 이미지처리 등 분산형 워크로드에 추천
    - 일시적요청 or 지속적인요청 옵션이 있음(중단될경우 인스터스 재시작 여부)
        - 종료를 원할경우 순서는 스팟 요청을 취소하고 연결된 스팟인스턴스를 종료시켜야한다.
    - 최고비용을 정한후 그보다 한단계 낮은 인스턴스 사용 → 현재 인스턴스가 정의된 최고 가격보다 높아지는경우에는 2가지 옵션이있다 (2분간의 유예기간 )
        1. 인스턴스 중단 후 스팟가격이 낮아지면 재시작
        2. 완전히 종료 후 새로운 인스턴스로 다시 재시작
        - **시험출제 - 즉 아주중요한 작업이나 데이터베이스에는 적절하지않다**
    - 스팟플릿
        - 한 세트의 스팟인스턴스에다가 선택적으로 온디맨드를 조합
        - **여러가지 런치풀과 인스턴스 유형을 다양하게 정의가 가능함**
        - 정해진 가격내에서 용량을 맞추려 시도함
        - 사용가능한 런치풀을 통해 실행
            - 다양한 OS AZ존, 인스턴스타입이 정의되어있음
        - 중단되는경우 플릿이 풀에서 최적화된 타입을 골라줌(스팟인스턴스와의 차이)
            - 기준
                - owestprice(낮은가격순) - 짧은 워크로드
                - diversified(정의한 모든 풀 분산) - 긴워크로드, 가용성 굳
                - capacityOptimized - 인스턴스의 개수에 따라 최적 용량으로 실행
- 전용 호스트
    - 온디맨드 가격
    - 실제 물리적 서버를 받게됨
    - **법적준수요건**이 있거나 소켓, 코어, VM 소프트웨어, **라이선스**가 있는 경우 사용
    - 가장 비싼 옵션임
- 전용 인스턴스
    - 내 전용 하드웨어에서 실행되는 인스턴스
    - 같은계정에서 다른인스턴스와 함께 하드웨어를 공유할 수 있음
    - 인스턴스 배치에 대한 통제권이 없음
    - 시험출제 : 전용 인스턴스 vs 전용호스트
        - 전용인스턴스 : 인스턴스를 자신만의 하드웨어에 갖음
        - 전용호스트 : 물리적 서버 자체에 대한 접근권을 갖고, 낮은 수준의 하드웨어에 대한 가시성을 제공
- EC2 용량 예약
    - 원하는 기간동안 특정한 AZ에서 온디맨드 인스턴스를 예약
    - 필요할때마다 용량 변경
    - 기간약정 제약 없음
    - 온디맨드가격 but 용량을 예약하면 인스턴스 실행여부에 무관하게 용량에 대한 요금을 부과함
    - 청구할인 받으려면 지역별 예약 인스턴스와 결합하거나, 절약플랜과 결합
    - 특정한 AZ가 필요한 단기적이고 중단없는 워크로드에 적합
    
    -