# Section21. AWS의 데이터 베이스

- 쓰기, 읽기, 워크로드, 처리량, 저장량, 확장성 등에 따른 선택이 필요
- 데이터베이스 유형
    - RDBMS 데이터베이스
        - SQL을 사용하거나 온라인 트랜잭션을 처리할 때 사용
        - RDS, Aurora 등 해당
        - 조인에 유용
    - NO SQL 데이터베이스
        - 유연하지만 조인 기능이 없고 SQL 쿼리 언어를 사용하지 않음(예외있음)
        - mynamoedb, elasticache, neptune, documentdb, keyspaces 등
    - object store
        - s3, gracier
    - data warehouse (sql 분석, bi 비즈니스 인텔리전스 사용)
        - redshift, athena, emr 포함
    - 검색
        - 자유롭게 텍스트 입력하거나 비정형 데이터 검색 가능
    - 그래프 데이터 베이스
        - 데이터 세트간의 관계를 표시
        - neptune 등
    - ledger(원장) 데이터베이스
        - 트랜잭션 목록과 원장 기록
        - QLDB(quantum ledger database) 등
    - time series
        - amazon timestream 등
    
    RDS
    
    - 관리형 pstgresql, mysql, oracle, sql server, mariadb, custom
    - rds 인스턴스 크기와 ebs 볼륨 유형 및 크기를 프로비저닝 해야함
    - 스토리지 계층에 오토 스케일링 기능이 있어도 프로비저닝 해야함
    - 읽기 용량 확장을 위해 읽기 전용 복제본 지원
    - 고가용성 목적으로 대기 데이터베이스를 다중az에 둘 수 있음(재해대비용으로 쿼리 수행은 못함)
    - 보안은 iam을 통해 설정(이름, 비밀번호 / iam 인증 / 보안그룹 설정 / 저장데이터 - kms/ 전송중 - ssl, tls)
    - 자동백업옵션(최대 35일)
        - 35일 간 지정 시간 복구 기능 지원하고 복구 시 새 데이터베이스 생성
    - 장기보존 백업이 필요한 경우 수동 db 스냅샷
    - 유지 관리 기능을 얘약할 수 있어 데이터베이스 다운타임 발생 가능
        - 프로비저닝, 데이터베이스 엔진을 주기적 업데이트, ec2 보안패치 실행 시에 발생 가능하다
    - RDS 프록시를  강제하여 rds에 iam 인증을 추가하는 기능
        - secret manager와 통합하여 db자격증명을 관리할 수도 있다
    - 기본 인스턴스에 액세스하고 사용자 지정하려면 RDS 사용자 지정 옵션 사용(오라클, sql server 에서만 지원)
    - 관계형 데이터베이스를 저장하는데 활용
        - rdbms와 온라인 트랜잭션 처리 데이터베이스(OLTP)가 포함
        - SQL 쿼리를 실행할수도있고 트랜잭션에도 활용

Aurora

- 데이터베이스 엔진인 postgreSQL, mysql과 호환되는 api
- 컴퓨팅과 스토리지가 분리된 서비스
- 스토리지
    - 기본적으로 세 가용영역에 걸쳐 6개의 복제본에 저장 → 가용성이 아주 높음
    - 스토리지에 문제 발생 시 백그라운드에서 자가 복구 처리
    - 오토스케일링 내장
- 컴퓨팅
    - 클러스터화된 데이터베이스 인스턴스를 여러 가용영역에 걸쳐 저장
    - 읽기전용 복제본이 있다면 로드가 증가할 때 오토 스케일링을 통해 용량을 늘릴 수 있음
    - 클러스터가 있어 읽기와 쓰기를 위한 사용자 지정 엔트포인트, 즉 writer endpoint, reader endpoint 필요
    - 보안 모니터링, 유지 관리 기능 (rds와 동일)
    - 백업 및 복구 옵션
    - 추가기능
        - aurora serverless
            - 워크로드가 간헐적이거나 예측할 수 없는 경우 용량 계획을 하지 않아도되므로 매우 유용
        - Aurora Multi-master
            - 쓰기 장애조치가 지속해서 필요할때 사용(쓰기 고가용성을 위함)
            - db 인스턴스 여러개가 스토리지에 쓰기를 할 수 있도록 설정 가능
        - Aurora Global
            - 글로벌 데이터베이스를 원할 때 사용
            - 데이터베이스가 복제된 리전마다 최대 16개의 데이터베이스 읽기 전용 인스턴스 제공되고 리전 간 스토리지 복제에 걸리는 시간은 일반적으로 1초 미만
            - 문제 발생 시 보조 리전을 새 리전으로 승격 가능
        - Aurora Machine Learning
            - sagemaker와 comprehend를 사용해 aurora에서 머신러닝 수행 가능
        - Aurora Database Cloning
            - 프로덕션 데이터베이스로부터 테스트, 스테이징 데이터 베이스 만드려면 이 기능 사용해 기존 클러스터에서 새 aurora 클러스터 만들면 됨
            - 스냅샷을 사용해서 복구하는 것보다 훨씬 빠르다
        - 사용사례는 rds와 동일하나 유지관리할게 적고 유연성이 높다. 성능도 더 좋고 내장 기능도 많다
    

Amazon elasticache

- 관리형 redis/memcached 로 rds와 비슷한 기능을 제공하나 캐싱 작업에 활용됨
- 인 메모리 데이터 스토어로 데이터를 읽을 때 1밀리초 미만의 지연시간 제공
- 캐시를 위한 ec2 인스턴스 유형을 프로비저닝해야함
- redis용에서는 클러스터 생성, 다중 az와 샤딩을 위한 읽기 전용 복제본을 사용할 수 있음
- 보안 - iam을 통해 프로비저닝한 보안, 보안그룹사용, kms(저장 데이터 암호화),redis 인증 사용 가능
- 백업 , 스냅샷, 지정시간 복구 기능
- 관리형 및 예약 유지관리 가능
- rds가 결합된 데이터베이스에서 캐싱 작업을 수행하려면 애플리케이션 코드가 elasticache를 활용하도록 코드를 수정해줘야함
- 사용사례
    - 키-값 스토어
    
    [데이터베이스를 자주 읽는다면 쿼리 캐싱](https://www.notion.so/3b986c310d93408eacd3656e650a6fc0?pvs=21)
    
    - 웹 사용자를 위해 세션 데이터 저장

Amazon DynamoDB 

- 관리형 서버리스 nosql 데이터베이스
- 밀리초 수준의 지연시간 제공
- 용량모드
    - 프로비저닝 모드
        - 오토스케일링 탑재 - 점진적 늘어나거나 줄어드는 이중 워크로드 있을 때 유용
    - 온디맨드 용량 모드
        - 용량을 프로비저닝 하지 않아도됨
        - 오토스케일링이 실행되므로 워크로드를 예측하기 어려울 때, 데이터베이스 수요 급증할 때 사용
- elasticache 대신 dynamodb에 키-값 저장 가능(웹 사이트의 세션 데이터를 저장하는 좋은 방법, ttl과 결합하면 일정 시간 후 만료)
- 높은 가용성 - DEFAULT 다중AZ, 읽기 쓰기 분리, dynamodb 테이블에서 트랜잭션 처리
- DAX 클러스터 생성하면 dynamodb와 호환되는 읽기 캐시를 생성할 수 있다. 읽기 지연 시간 낮음(백만분의 1초)
- 보안, 인증, 권한부여 - iam
- dynamodb에는 이벤트 처리 용량이 있어 streams 데이터베이스의 모든 변경 사항을 스트리밍 가능
    - lambda와 통합 가능하며 dynamodb 테이블에서 변경이 발생할때마다 lambda가 실행됨
    - dynamodb streams 대신 kinesis data stream도 가능 - kinesis data firehose와 같은 다른 통합 기능을 사용할 수 있음.. 보유기간을 1년까지 설정 가능
- global table 기능
    - 여러 리전 간에 다중활성(여러 리전에서 읽기쓰기가능) 복제 가능
    - 백업 옵션
        - 자동 백업
            - 지정시간 복구를 활성화하면 새 dynamodb 테이블에 복구 가능(35일까지)
        - 온디맨드 백업
            - 장기간 백업
- 지정 시간 복구 기간 내에 rcu를 사용하지 않고 dynamodb 테이블 s3로 내보낼 수 있음(s3 내보내기 기능 사용), wcu를 사용하지않고 s3 import가능
- 스키마를 빠르게 전개해야하는경우 사용된다
- 사용사례
    - 400kb 미만의 문서를 다루는 작은 서버리스 애플리케이션 개발
    - 서버리스 캐시 분산
- sql 쿼리 언어 사용 불가

S3

- 키-값 저장
- 큰 객체를 저장할때 유용/여러개의 작은 객체를 저장할 땐 유용하지 않음
- 서버리스 - 확장성 무한
- 객체 최대 크기 : 5tb
- 스토리지 계층 다양(standard, gracier 등) + 계층 전환 시 수명 주기 정책 사용
- 주요 기능 : 버저닝, 암호화, 복제, 멀티팩터인증 삭제, 액세스 로그
- 보안 기능 : iam, 버킷 정책, acl 기능, s3 access point, s3 object lambda( 객체를 애플리케이션에 전송하기 전 수정 가능), cors, glacier 객체 잠금, 볼트 잠금
- 암호화 : SSE-S3, SSE-KMS, SSE-C, 클라이언트측, tls, 기본 암호화
- batch operation : s3 버킷에 있는 모든 파일을 한번에 작업
    - 기존 s3 버킷의 비암호화 객체를 암호화한다거나 s3 복제를 활성화 하기 전 기존 파일을 다른 버킷으로 복사할 때 유용
    - 파일 목록은 s3 inventory를 사용해 생성
- 최근 기능 : 멀티파트 업로드(파일 병렬식 업로드), s3 전송 가속화 (다른 리전으로 더 빠르게 파일 전송), s3 select ( 필요한 데이터만 검색)
- s3 event notifications : 자동화를 하게해줌 - sns, sqs, lambda, eventbridge 인터페이스
- 사용사례 : 정적파일, 큰 파일의 키-값 store, 웹 사이트 호스팅

Document DB

- Aurora로 AWS에서 postgresql과 mysql의 대규모 클라우드 네이티브 버전을 구현하는 것과 비슷함
- mongoDB 용 aurora
    - mongodb
        - nosql 데이터베이스
        - json 데이터를 저장, 쿼리, 인덱싱 하는데 사용
- nosql 용 데이터 베이스
- aurora와 같은 배포 개념이 있다
    - 완전 관리형 데이터베이스 → 가용성이 높다. 3개의 가용영역에 복제
- 스토리지 : 자동으로 10GB 단위로 최대 64TB까지 증가
    - 초당 수백만건의 요청이 있는 워크로드로 확장될 수 있도록 설계됨

Amazon Neptune

- 완전 관리형 그래프 데이터베이스
- 그래프 데이터 셋(소셜 네트워크 같은 케이스, 지식 그래프)
- 3개의 az에 걸쳐 최대 15개의 읽기 전용 복제본으로 복제
- 소셜 네트워크처럼 고도로 연결된 데이터 셋을 사용하는 애플리케이션을 구축하고 실행하는데 사용
    - 복잡하고 어려운 쿼리 실행에 최적화
- 데이터베이스에 최대 수십억 개의 관계 저장 가능, 그래프를 쿼리할 때 지연시간 밀리초
- 가용성 높음 - 여러 가용 영역

Amazon keyspaces( for apache cassandra)

- aws의 관리형 apache cassandra 보조
- cassandra
    - 오픈소스 nosql 분산 데이터베이스
- 클라우드에서 aws가 cassandra를 직접 관리해줌
- 서버리스 서비스
- 확장성, 가용성 높음, aws 완전 관리형
- 애플리케이션 트래픽 따라 테이블 자동 확장, 축소
- 테이블 데이터 여러 az존에 걸쳐 3번 복제
- 쿼리를 수행하려면 cassandra 쿼리(cql)을 사용해야함
- 지연시간이 10밀리초 미만. 초당 수천건의 요청을 처리
- 두가지 용량 모드
    - 온디맨드
    - 프로비저닝 - 크기 자동조정
- 암호화, 백업기능 제공, 지정 시간 복구 가능(최대 35일)
- 사용사례 : iot 장치 정보, 시계열 데이터 저장

Amazon QLDB(Quantum ledger database)

- 금융 트랜잭션 원장을 갖음
- 완전 관리형 데이터베이스, 서버리스 , 높은 가용성, 3개의 가용영역에 걸쳐 데이터 복제
- 애플리케이션 데이터의 시간에 따른 모든 변경 내역을 검토하는데 사용
- 불변시스템 - db에 삭제 혹은 수정 불가(암호화 서명을 하기도함 - 해시사용)
- 일반 원장 블록체인 프레임워크보다 2-3배 더 나은 성능
- SQL을 사용하여 데이터 관리 가능
- 탈중앙화 개념 없음
- 중앙 데이터베이스에서만 저널 작성 가능(금융 규제에 적합)

Amazon TimeStream

- 시계열 데이터베이스
    - 시계열 : 시간 정보를 포함하는 포인트의 모음
- 완전관리형이며 빠르고 확장성 있는 서버리스 서비스
- 데이터베이스의 용량을 자동으로 확장, 축소 가능
- 매일 수조건의 이벤트를 저장 및 분석 가능
- 시계열데이터의 경우에는 관계형보다는 타임스트림을 사용하는것이 훨씬 저렴하고 빠름
- 쿼리를 예약하고 다중척도 레코드를 얻을 수 있음
- SQL과 완벽히 호환
- 최신데이터는 메모리에 저장되고 과거 데이터는 비용 효율적인 스토리지 계층에 저장
- 시계열 분석 기능이 있어 실시간으로 데이터 분석 및 패턴 찾을 수 있음
- 전송 중 암호화, 저장 데이터 암호화 지원
- 사용사례
    - iot 애플리케이션
    - 운영 애플리케이션
    - 실시간 분석