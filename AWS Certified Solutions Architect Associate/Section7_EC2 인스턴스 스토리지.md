# Section7. EC2 인스턴스 스토리지

Date: June 3, 2023

EBS Volume ( Elastic Block Store)

- 인스턴스가 실행중인 동안 연결가능한 네트워크 드라이브
- 목적 : 인스턴스가 종료된 후에도 데이터를 지속 가능
- CCP레벨 : 하나의 ebs는 하나의 ec2 인스턴스에만 마운트 가능/ 어소시에이트 레벨: 일부 EBS 다중연결 ( 하나의 인스턴스에 두개이상 볼룸이 붙는건 상관없다)
- 가용영역 고정(스냅샷을 이용하면 다른영역으로도 볼륨을 옮길수 있다)
- 네트워크 드라이브(물리적 x)
- 독립적이므로 다른인스턴스로 옮겨붙일수있다
- 용량, 초당전송수 미리 정의
- EC2인스턴스를 통해 EBS 볼륨을 생성하는경우 종료시 삭제라는 속성이 있다 - 루트볼륨은 이설정이 default/추가생성은 비활성화가 default

EBS 볼륨 유형(시험은 gp2, IOPS 프로비저닝이 중요)

- gp2/gp3 (SSD) : 범용 SSD 볼륨. **효율적인 가격/성능 균형 굳**
    - gp2: 짧은 지연시간을 자랑하며 효율적인 비용의 스토리지. 1gib~16tib 로 다양
    - gp3 : 최신세대의 볼륨으로 3000~16000 IOPS, 125~1000 MIB 처리량
    - 둘의 차이는 gp2는 처리량과 IOPS가 연결되어있어 영향받음. gp3는 독자적
- io 1/ io 2 (SSD) : 최고성능. 지연시간이 낮고 대용량의 워크로드에 쓰임
    - 동일한 비용에 io2가 io1보다 IOPS가 더 높다
    - 32,000 IOPS 가 필요한 경우 사용
    - 다중연결지원
- st1 (HDD) : 저비용의 HDD 볼륨. 잦은 접근과 처리량이 많은 워크로드
    - 사용: 빅데이터, 데이터웨어 하우징 로그 처리
- sc1 (HDD) : **가장 비용이 적게드는** HDD볼륨. 접근 빈도가 낮은 워크로드를 위해 설계

EBS 볼륨은 처리량, 크기, IOPS(초당 io 작업수)에 따라 정함

- gp2/gp3 와 io 1/ io 2 만이 부팅 볼륨으로 사용 가능(루트 OS가 실행될 위치)

EBS Snapshots

- EBS 볼륨의 특정 시점에 대한 백업
- 다른 가용영역이나 리전에 복사 가능
- EBS Snapshot Archive
    - 저렴한 아카이브 티어로 스냅샷을 옮길 수 있는 기능(즉시 복원x, 24-72시간 걸림)
- EBS Snapshots 휴지통
    - 영구 삭제하는 대신 휴지통에 넣을 수 있음(기간 1일-1년)
- 빠른 스냅샷 복원
    - 스냅샷을 완전 초기화해 지연시간 줄임)
    - 비용이 많이듬

AMI(Amazon Machine Image)

- ec2인스턴스를 통해 만든 이미지
- 원하는 소프트웨어, 설정파일, os설치, 모니터링 추가 등이 가능
- 부팅 및 설정에 드는 시간 줄일 수 있음 - AMI가 미리 패키징 하고 있음
- 복사해서 다른 리전에서 사용도 가능
    - 공용 AMI : AWS제공
    - 자체 ami  : 개인 구성
    - AWS MARKETPLACE AMI : 일반적으로 기업에서 판매용
- ami process(from ec2)
    1. EC2 생성
    2. 인스턴스 중지(데이터 무결성을 위해)
    3. 인스턴스로 AMI를 만듬(스냅샷도 생김)
    4. AMI를 통해 인스턴스 생성
    

EC2 인스턴스 스토어

- 높은 하드웨어 디스크 성능 필요 시에 사용 (EC2에 연결된 하드웨어 디스크)
- EBS VOLUME은 네트워크드라이브로 성능에 제한이 있다. 그럴때 인스턴스 스토어를 사용함
- I/O 성능 굳
- 인스턴스 스토어는 인스턴스롤 종료및중지 시 같이 손실됨(임시 스토리지)
- 사용 : 버퍼, 캐시, 임시 콘텐츠 등 단기적 저장소 ( 장기는 EBS가 적합)
- EC2인스턴스의 장애가 났을경우 동시에 같이 손실위험 - 백업필요함

프로비저닝 IOPS

- EBS 다중연결 지원
- iops 성능을 유지할 필요가있는 주요 비즈니스 애플리케이션이나 16,000 IOPS 이상을 요하는 애플리케이션에 적합
- 사용 : 데이터베이스
- io1/io2 를 고르는것이 좋음

EBS 다중연결

- 같은 AZ존에 있는 EC2들을 하나의 EBS에 연결할 수 있게해줌 (최대 **16**개)
- io1, io2 만 지원
- 인스턴스들은 동시에 읽기쓰기 가능
- 사용: 가용성 높은 리눅스 애플리케이션, 동시쓰기 작업이 필요한 애플리케이션
- 반드시 클러스터 인식 파일 시스템을 사용해야함(XFS, EX4 등은 안됨)

EBS 볼륨 암호화

- 불륨내 데이터 암호화
- 볼륨간 인스턴스 사이 암호화하여 전달
- 모든 스냅샷 암호화/ 모든 스냅샷으로 생성한 볼륨 암호화
- 암호화 복호화 매커니즘은 보이지않게 처리되며 백그라운드에서 EC2, EBS가 모두 처리
- 지연시간에는 거의 영향없음
- KMS에서 암호화 키를 생성해 AES-256 암호화 표준을 갖음
- 암호화 및 복호화 하는법
    1. EBS 볼륨의 스냅샷을 만든다
    2. 복사기능을 통해 EBS스냅샷을 암호화 한다
    3. 스냅샷을 이용해 새 EBS 볼륨을 생성하면 해당 볼륨도 암호화가 된다
    4. 암호화된 볼륨을 인스턴스 원본에 연결한다.
    

Amazon EFS ( Elastic File System)

- 관리형 NFS. 네트워크 파일 시스템
- 여러 EC2 인스턴스에 마운트 될 수 있음(EC2 인스턴스들은 여러 가용 영역에 있을수 있다)
- 가용성, 확정성 good, 가격 bad(사용량만큼 지불함- 미리 용량 계획하지 않아도 됨 . 자동확장)
- 내부적으로 NFS 프로토콜 사용
- EFS에 대한 액세스를 제어하기 위해서는 보안그룹을 설정
- **Window가 아닌 Linux 기반 AM와 호환**
- KMS를 사용해 EFS 드라이브에 저장 데이터 암호화를 활성화 가능함
- 리눅스 표준 파일 시스템으로 POSIX 시스템 사용
- EFS 성능
    - 수천개의 NFS 클라이언트에서 EFS에 동시 액세스 할 수 있게 확장되며 처리량은 초당 10GB
    - PB규모로 자동확장
    - 다양한 성능모드
        - 범용모드 ( 웹서버, cms 등) - 지연시간 중요
        - MAX I/O 모드 :  처리량, 병령처리 기능 향상 ( 빅데이터, 미디어 처리 등)
        - 처리량 모드 : 기본값이 버스팅(1TB = 초당 50~100MIB), 프로비저닝 설정 가능(스토리지 크기에 상관없이 처리량 설정 가능)
- 스토리지 클래스 옵션
    - 스토리지 계층 설정 - 일정기간 후에 파일을 다른 계층으로 옮기는 기능
        - Standard 계층 : 액세스 빈번.
        - EFS - IA 계층 : 파일을 검색할 경우 검색비용 발생 but 저장 비용 낮음. 활성화시 수명주기정책 필요
    - 가용성 내구성 측면
        - Standard : MULTI AZ, 프로덕션에 적합
        - One zone : 하나의 AZ, 개발에 적합. 백업이 디폴트, EFS-IA 계층과 호환(90프로 할인)
- 사용 : 컨텐츠 관리, 웹 서버, 데이터 공유 wordpress

EFS VS EBS

- 인스턴스 연결 개수 ( 여러개 / 1개)
- AZ존 제한( 제한x/ 제한- 스냅샷을 통해 복원[인스턴스가 EBS를 사용하지않을때 스냅샷사용])
- 인스턴스 종료시 EBS 볼륨도 종료
- EFS가 훨씬 비쌈(비용절약 원할 시 스토리지 티어로 EFS-IA사용)
- 비용청구방식 : 사용량/EBS드라이브 크기에 따라 정해진 사용량
- 다수의 인스턴스를 연결해야하는 네트워크 파일시스템에 적합/ 네트워크 볼륨을 한번에 하나의 인스턴스에 연결 및 AZ한정
    - 별개로 인스턴스 스토어는 I/O를 인스턴스가 최대로 사용할 수 있게 해주지만 인스턴스가 망가지만 함께 die..
