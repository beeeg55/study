# Section12. Amazon S3 소개

Date: June 9, 2023

S3 용도

- 백업, 스토리지
- 파일용, 디스크용 모두 가능
- 재해 복구 - 리전 다운되는 경우 데이터를 다른 리전으로 백업시키는동안 s3에 임시 저장
- 아카이브 - 파일저장
- 하이브리드 클라우드 스토리지
- 웹 호스팅
- 미디어 호스팅 ( 동영상, 이미지 등)
- 데이터 레이크를 보유 (단순 다량 데이터 저장 혹은 빅데이터 분석을 수행)
- 정적 웹 호스팅

버킷

- S3는 파일을 버킷에 저장함
- 상위라벨 디렉토리로 표시
- 버킷의 파일 = 객체계정안에 생성
- 전역적으로 고유한 이름을 가짐 ( 모든 리전과 모든 계정에서 고유해야함)
- 리전수준에서 정의 ( S3는 전역서비스처럼 보이지만 사실상 버킷은 리전에서 생성)
- 명명규칙
    - 대문자x, 밑줄x
    - 3-63자
    - ip x
    - 소문자나 숫자로 시작
    - 접두사 제한
    - 문자, 숫자, 하이픈만 사용

객체

- 키를 가짐 (키 = 파일의 전체 경로(접두사 + 객체이름))
- 값은 본문의 내용
    - 파일 등 모든것을 업로드 가능
    - 최대 크기 5TB(5000GB)
        - 이상인경우 멀티파트 업로드 사용하여 나눠서 업로드
- 메타데이터 : 객체의 키-값 쌍 리스트
- 태그 : 유티코드 키-값 쌍은 최대 10개까지 가능
    - 보안과 생명주기에 유용
- 버전 ID를 갖기도함

보안

- 사용자 기반
    - IAM 정책  - 어떤 api호출이 특정 iam 사용자를 위해 허용되어야하는지를 승인
- 리소스 기반
    - **s3 버킷 정책**
        - 콘솔에서 직접 할당할 수 있는 전체 버킷 규칙
        - 특정 사용자가 들어올 수 있게 하거나 다른 계정의 사용자를 허용할 수 있음(교차계정)
        - 가장 많이 사용
        - json 기반
        - 아래와 같은 용도등으로 사용
            - 버킷을 public화
            - 업로드 시 객체를 암호화하도록 강제성 부여
            - 다른 계정으로 액세스 허용 - 추가 버킷 정책 사용
    - 객체 어세스 제어 목록(ACL)
        - 세밀한 보안
        - 비활성화 가능
    - 버킷 어세스 제어 목록(ACL)
        - 잘 사용 ㄴㄴ
        - 비활성화 가능
- 암호키 사용
- 블록 공개 액세스
    - 기업데이터 유출을 방지하기위한 추가 보안계층 사용
        - public으로 한다해도 이를 사용하면 공개 불가

→ IAM 이 s3객체에 접근할 수 있는 케이스

- IAM 권한이 허용하는 경우
- 리소스 정책이 이를 허용하는 경우
- 명백한 deny는 없음

정적 웹 호스팅

- 웹 사이트를 호스팅하고 인터넷에서 액세스 하게 해줌
- aws리전에 따라 url 달라짐 ( 아래 둘중 하나)
    - http://bucket-name.s3-website-aws-region.amazonaws.com
    - http://bucket-name.s3-website.aws-region.amazonaws.com
- html , 이미지 등이 있다
- 버킷에서 공개 읽기 활성화 되지 않으면, 403 forbibdden error

버전

- 버킷 수준에서 활성화
- 파일 버전관리 가능
- 동일한 키로 덮어쓰기하는 경우 버전 생성
- 의도치 않은 삭제에서 지켜줌 ( 롤백, 버전복구 가능)
- 버전 관리 활성화 전 적용x파일든은 null버전을 갖게됨. 이후 올린 파일들은 version id를 갖게됨
- 버전관리 중단해도 이전버전 삭제되지않음
- 삭제하면 전 버전으로 롤백됨

복제

- 소스버킷, 복제 대상 버킷 모두 버전 관리 기능 활성화되어있어야함
- 서로 다른 aws 계정간에도 사용 가능
- 비동기식으로 백그라운드에서 복제진행됨
- s3에 올바른 iam 권한(읽기, 쓰기)를 부여해야함
- CRR(교차 리전 복제)
    - 용도 : 컴프라이언스, 법규 및 체제 관리 데이터가 다른 리전에 있어 발생 지연시간 줄이는 경우, 계정간 복제
- SRR(같은 리전 복제)
    - 용도 : 로그 통함, 개발-운영 환경 데이터 실시간 복제
- 새로운 객체만 복제 대상(기존 객체, 복제 객체 실패 복제하려면 s3 배치 복제 기능 사용)
- 작업을 삭제하려면 소스 버킷에서 대상 버킷으로 삭제 마커를 복제하면 됨
    - 삭제마커는 기본적으로 복제되지않지만, 설정으로 바꾸기 가능
    - 복제는 삭제동작이아닌 삭제마커!
- 버전 id 로 삭제하는 경우 버전 id 는 복제되지않음(남용을 막기위함)
- 체이닝 복제 불가(a→ b, b→c, 인 경우 a→c 불가)

S3 스토리지 종류 클래스

S3에서 객체를 생성할 때  클래스를 선택할 수도 있고 스토리지 클래스를 수동으로 수정할 수도 있다

혹은 s3 생명주기 구성을 사용해 스토리지 클래스 간에 객체를 자동으로 이동가능

- Amazon s3 standard - general purpose
    - 가용성 : 99.99
    - 가장 기본적인 s3 스토리지 클래스
    - 자주 액세스하는 데이터에 사용
    - 지연시간이 짧고 처리량이 높음
    - 2개의 기능장애를 동시에 버틸 수 있음
    - 사용사례 : 빅데이터 분석, 모바일및게임 애플리케이션, 콘텐츠 배포
- Amazon s3 standard-Infrequent Access (IA)
    - 가용성 : 99.9
    - 자주 액세스 하지는 않지만 필요한경우 빠르게 접근해야하는 데이터
    - S3 Standard보다는 적은 비용이지만 검색비용 발생
    - 사용사례 : 재해복구, 백업
- Amazon s3 one zone-Infrequent Access(S3 ONE ZONE-IA)
    - 단일 AZ에서는 높은 내구성을 갖지만 , AZ가 파괴된 경우 데이터를 잃게됨
    - 가용성 : 99.5
    - 사용사례 : 온프레미스 데이터 2차 백업, 재생성 가능한 데이터를 저장

glacier stoage class

- 콜드 스토리지
- 아카이빙과 백업을 위한 저비용 객체 스토리지
- 비용 : 스토리지 비용, 검색 비용
- Amazon s3 glacier instant retrieval
    - 밀리초 단위로 검색가능
    - 분기에 한번 액세스하는 데이터, 백업이지만 밀리초 이내에 엑세스해야하는 경우에 적합
    - 최소 보관 90일
- Amazon s3 glacier flexible retrieval
    - 3가지 옵션이 있다 - expedited(1-5분내 받음), standard(3-5시간 내), bulk(5-12시간내,무료)
    - 최소 보관 90일
- Amazon s3 glacier deep retrieval
    - 2가지 검색옵션 - standard(12시간) , bulk(48시간)
    - 비용 가장 저렴, 최소보관기간 180일
- Amazon s3 inteeligent tiering
    - 사용패턴에 따라 액세스된 티어 간에 객체를 이동할 수 있게 해줌
    - 소액의 월별 모니터링 비용, 티어링 비용 발생 but 검색비용 없음
        - frequent access 티어(자동) : 기본티어
        - infrequent access 티어(자동) : 30일동안 액세스하지 않는 객체 전용 티어
        - archive instant access 티어(자동) : 90일동안 액세스하지 않는 객체 전용 티어
        - archive access 티어(옵션) : 90~700일 이상동안 액세스하지 않는 객체 전용 티어
        - deep archive access 티어(옵션) : 180~700일 이상동안 액세스하지 않는 객체 전용 티어

내구성과 가용성

내구성 : s3로 인해 객체가 손실되는 횟수

- S3는 뛰어난 내구성
- 99,9999999..
- 모든 스토리지 클래스 동일수치 내구성

가용성 : 서비스가 얼마나 유용하게 제공

- 스토리지 클래스에 따라 수치 다름